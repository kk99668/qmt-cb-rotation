<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QMTè‡ªåŠ¨è°ƒä»“</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        /* ç™»å½•é¡µé¢æ ·å¼ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            width: 400px;
        }

        .login-box h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #5568d3;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 10px;
            display: none;
            text-align: center;
        }

        /* é£é™©æç¤ºé®ç½© */
        .risk-disclaimer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 99999;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
        }

        .risk-disclaimer-box {
            background: white;
            padding: 32px 40px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            width: 520px;
            max-width: 90vw;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }

        .risk-disclaimer-box h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #2c3e50;
            font-weight: 600;
        }

        .risk-disclaimer-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: #f9f9f9;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.8;
            color: #333;
        }

        .risk-disclaimer-content p {
            margin-bottom: 8px;
        }

        .risk-disclaimer-box .btn {
            align-self: flex-end;
            width: auto;
            padding: 10px 24px;
        }

        /* ä¸»ç•Œé¢æ ·å¼ */
        .main-container {
            display: none;
            height: 100vh;
            flex-direction: column;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .current-strategy {
            padding: 5px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            font-size: 13px;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .current-strategy.empty {
            color: #95a5a6;
        }

        .icon-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 4px;
            transition: background 0.3s;
            font-size: 13px;
        }

        .icon-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .icon-btn.running {
            background: rgba(39, 174, 96, 0.3);
            color: #2ecc71;
        }

        .icon-btn.running:hover {
            background: rgba(39, 174, 96, 0.4);
        }

        .content-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        .panel h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
            font-weight: 500;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .status-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }

        .status-card h3 {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            font-weight: normal;
        }

        .status-card .value {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .status-card .status {
            margin-top: 8px;
            font-size: 12px;
        }

        .status-running {
            color: #27ae60;
        }

        .status-stopped {
            color: #e74c3c;
        }

        .holdings-table {
            width: 100%;
            border-collapse: collapse;
        }

        .holdings-table th,
        .holdings-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }

        .holdings-table th {
            background: #f8f9fa;
            font-weight: 500;
            color: #555;
        }

        .holdings-table tbody tr:hover {
            background: #f8f9fa;
        }

        .profit-positive {
            color: #e74c3c;
        }

        .profit-negative {
            color: #27ae60;
        }

        .log-area {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
        }

        .log-entry {
            margin-bottom: 4px;
            padding: 2px 0;
        }

        .log-time {
            color: #6a9955;
        }

        .log-INFO {
            color: #569cd6;
        }

        .log-SUCCESS {
            color: #4ec9b0;
        }

        .log-WARNING {
            color: #dcdcaa;
        }

        .log-ERROR {
            color: #f14c4c;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 25px;
            position: relative;
        }

        .modal-content h1 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .modal-close:hover {
            color: #333;
        }

        /* ç­–ç•¥é€‰æ‹©æ¨¡æ€æ¡† */
        .strategy-modal-content {
            max-width: 900px;
        }

        .strategy-selection-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .strategy-selection-panel {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
        }

        .strategy-selection-panel h2 {
            font-size: 15px;
            margin-bottom: 12px;
            color: #2c3e50;
            border-bottom: 2px solid #667eea;
            padding-bottom: 6px;
        }

        .strategy-list {
            list-style: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .strategy-item {
            padding: 10px 12px;
            margin-bottom: 6px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 13px;
        }

        .strategy-item:hover {
            background: #e9ecef;
        }

        .strategy-item.active {
            background: #667eea;
            color: white;
        }

        .backtest-item-detail {
            padding: 10px 12px;
            margin-bottom: 6px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .backtest-item-detail:hover {
            background: #e9ecef;
        }

        .backtest-item-detail.selected {
            background: #667eea;
            color: white;
        }

        .backtest-item-detail h3 {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .backtest-item-detail p {
            font-size: 11px;
            opacity: 0.8;
            margin: 0;
        }

        .backtest-selection-panel.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 12px;
        }

        .page-btn {
            padding: 4px 10px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 3px;
            font-size: 12px;
        }

        .page-btn:hover {
            background: #f8f9fa;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* é…ç½®è¡¨å• */
        .config-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .config-item {
            display: flex;
            flex-direction: column;
        }

        .config-item label {
            margin-bottom: 6px;
            color: #555;
            font-weight: 500;
            font-size: 13px;
        }

        .config-item input,
        .config-item select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }

        .config-item input:focus,
        .config-item select:focus {
            outline: none;
            border-color: #667eea;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-weight: normal;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-cancel {
            background: #95a5a6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-cancel:hover {
            background: #7f8c8d;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* å¸®åŠ©æ–‡æ¡£ */
        .help-section {
            margin-bottom: 25px;
        }

        .help-section h2 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .help-section p {
            line-height: 1.6;
            color: #555;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .help-link {
            color: #667eea;
            text-decoration: none;
        }

        .help-link:hover {
            text-decoration: underline;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-tip {
            color: #999;
            text-align: center;
            padding: 30px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <!-- é£é™©æç¤ºé®ç½©ï¼ˆå¯åŠ¨æ—¶æ˜¾ç¤ºï¼Œç”¨æˆ·ç¡®è®¤åéšè—ï¼‰ -->
    <div class="risk-disclaimer-overlay" id="riskDisclaimerOverlay">
        <div class="risk-disclaimer-box">
            <h2>é£é™©æç¤º</h2>
            <div class="risk-disclaimer-content">
                <p>1. æœ¬å·¥å…·ä¸ºå¼€æºå­¦ä¹ é¡¹ç›®ï¼Œéå®˜æ–¹ã€éå•†ç”¨ã€‚</p>
                <p>2. ä½œè€…ä¸å¯¹ä½¿ç”¨æœ¬å·¥å…·äº§ç”Ÿçš„ä»»ä½•ç›ˆåˆ©ã€äºæŸã€äº¤æ˜“å¼‚å¸¸ã€èµ„é‡‘æŸå¤±æ‰¿æ‹…è´£ä»»ã€‚</p>
                <p>3. å¯è½¬å€ºäº¤æ˜“ã€è½®åŠ¨ç­–ç•¥å‡å­˜åœ¨å¸‚åœºæ³¢åŠ¨ã€æµåŠ¨æ€§ã€è§„åˆ™å˜åŒ–ç­‰é£é™©ã€‚</p>
                <p>4. ä½¿ç”¨æœ¬å·¥å…·å³è§†ä¸ºå·²å……åˆ†ç†è§£é£é™©ï¼Œæ‰€æœ‰æ“ä½œä¸é£é™©è‡ªè¡Œæ‰¿æ‹…ã€‚</p>
                <p>5. æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…ã€‚</p>
            </div>
            <button type="button" class="btn" id="riskDisclaimerConfirm">æˆ‘å·²é˜…è¯»å¹¶åŒæ„</button>
        </div>
    </div>

    <!-- ç™»å½•é¡µé¢ -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h1>ğŸ± QMTè‡ªåŠ¨è°ƒä»“</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">è´¦å·</label>
                    <input type="text" id="username" name="username" placeholder="è¯·è¾“å…¥è´¦å·" required>
                </div>
                <div class="form-group">
                    <label for="password">å¯†ç </label>
                    <input type="password" id="password" name="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="rememberPassword">
                        è®°ä½å¯†ç 
                    </label>
                    <label>
                        <input type="checkbox" id="autoLogin">
                        è‡ªåŠ¨ç™»å½•
                    </label>
                </div>
                <button type="submit" class="btn" id="loginBtn">ç™»å½•</button>
                <div class="error-message" id="loginError"></div>
            </form>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="main-container" id="mainContainer">
        <div class="header">
            <h1>QMTè‡ªåŠ¨è°ƒä»“</h1>
            <div class="header-actions">
                <button class="icon-btn" id="selectStrategyBtn">ğŸ“‹ é€‰æ‹©ç­–ç•¥</button>
                <span class="current-strategy empty" id="currentStrategy">æœªé€‰æ‹©ç­–ç•¥</span>
                <button class="icon-btn" id="runBtn">â–¶ï¸ è¿è¡Œ</button>
                <button class="icon-btn" id="configBtn">âš™ï¸ è®¾ç½®</button>
                <button class="icon-btn" id="helpBtn">â“ å¸®åŠ©</button>
                <span id="userInfo">ç”¨æˆ·ï¼š-</span>
            </div>
        </div>

        <div class="content-wrapper">
            <div class="main-content">
                <!-- äº¤æ˜“çŠ¶æ€ç›‘æ§ -->
                <div class="panel">
                    <h2>äº¤æ˜“çŠ¶æ€ç›‘æ§</h2>
                    <div class="status-grid">
                        <div class="status-card">
                            <h3>è‡ªåŠ¨äº¤æ˜“çŠ¶æ€</h3>
                            <div class="value" id="tradingStatus">æœªè¿è¡Œ</div>
                            <div class="status status-stopped" id="tradingStatusText">â— å·²åœæ­¢</div>
                        </div>
                        <div class="status-card">
                            <h3>æ­¢ç›ˆæ­¢æŸç›‘æ§</h3>
                            <div class="value" id="monitorStatus">æœªç›‘æ§</div>
                            <div class="status" id="monitorStatusText">-</div>
                        </div>
                        <div class="status-card">
                            <h3>å½“å‰æŒä»“æ•°é‡</h3>
                            <div class="value" id="positionCount">0</div>
                            <div class="status">åªå¯è½¬å€º</div>
                        </div>
                        <div class="status-card">
                            <h3>è´¦æˆ·å¯ç”¨ä½™é¢</h3>
                            <div class="value" id="availableCash">Â¥0</div>
                            <div class="status">å…ƒ</div>
                        </div>
                        <div class="status-card">
                            <h3>æŒä»“ç›ˆäº</h3>
                            <div class="value" id="totalProfitLoss">Â¥0</div>
                            <div class="status">å…ƒ</div>
                        </div>
                        <div class="status-card">
                            <h3>æŒä»“ç›ˆäºæ”¶ç›Šç‡</h3>
                            <div class="value" id="profitLossYield">0%</div>
                            <div class="status">æ€»ç›ˆäº/æ€»æˆæœ¬</div>
                        </div>
                    </div>
                </div>

                <!-- å½“å‰æŒä»“ -->
                <div class="panel">
                    <h2>å½“å‰æŒä»“</h2>
                    <table class="holdings-table">
                        <thead>
                            <tr>
                                <th>ä»£ç </th>
                                <th>åç§°</th>
                                <th>æŒä»“æ•°é‡</th>
                                <th>æˆæœ¬ä»·</th>
                                <th>å½“å‰ä»·</th>
                                <th>ç›ˆäº</th>
                                <th>æ­¢ç›ˆä»·</th>
                                <th>æ­¢æŸä»·</th>
                            </tr>
                        </thead>
                        <tbody id="holdingsTableBody">
                            <tr>
                                <td colspan="8" class="empty-tip">æš‚æ— æŒä»“æ•°æ®</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ç³»ç»Ÿæ—¥å¿— -->
                <div class="panel">
                    <h2>ç³»ç»Ÿæ—¥å¿—</h2>
                    <div class="log-area" id="logArea">
                        <div class="log-entry">
                            <span class="log-time">[--:--:--]</span>
                            <span class="log-INFO">[INFO]</span> ç­‰å¾…ç™»å½•...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç­–ç•¥é€‰æ‹©æ¨¡æ€æ¡† -->
    <div class="modal" id="strategyModal">
        <div class="modal-content strategy-modal-content">
            <button class="modal-close" onclick="closeModal('strategyModal')">Ã—</button>
            <h1>é€‰æ‹©è¿è¡Œç­–ç•¥</h1>
            <div class="strategy-selection-area">
                <div class="strategy-selection-panel">
                    <h2>ç­–ç•¥åˆ—è¡¨</h2>
                    <ul class="strategy-list" id="strategyList">
                        <li class="empty-tip">åŠ è½½ä¸­...</li>
                    </ul>
                    <div class="pagination" id="strategyPagination"></div>
                </div>

                <div class="backtest-selection-panel disabled" id="backtestPanel">
                    <h2>å›æµ‹è®°å½•</h2>
                    <div id="backtestList">
                        <p class="empty-tip">è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç­–ç•¥</p>
                    </div>
                    <div class="pagination" id="backtestPagination"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- é…ç½®æ¨¡æ€æ¡† -->
    <div class="modal" id="configModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('configModal')">Ã—</button>
            <h1>é…ç½®ä¿¡æ¯</h1>
            <form class="config-form" id="configForm">
                <div class="config-item">
                    <label for="qmtPath">MiniQMT ç¨‹åºè·¯å¾„ (userdata_mini æ–‡ä»¶å¤¹)</label>
                    <input type="text" id="qmtPath" placeholder="ä¾‹å¦‚ï¼šD:\è¿…æŠ•æé€Ÿäº¤æ˜“ç»ˆç«¯\userdata_mini">
                </div>
                <div class="config-item">
                    <label for="accountId">è¯åˆ¸è´¦å·</label>
                    <input type="text" id="accountId" placeholder="è¯·è¾“å…¥è¯åˆ¸è´¦å·">
                </div>
                <div class="config-item">
                    <label>å•åªä¹°å…¥é‡‘é¢æ–¹å¼</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="buyAmountType" value="fixed">
                            å›ºå®šé‡‘é¢
                        </label>
                        <label>
                            <input type="radio" name="buyAmountType" value="average" checked>
                            æŒ‰å¯ç”¨ä½™é¢å¹³å‡åˆ†é…
                        </label>
                    </div>
                </div>
                <div class="config-item" id="fixedAmountGroup" style="display: none;">
                    <label for="fixedAmount">å›ºå®šé‡‘é¢ï¼ˆå…ƒï¼‰</label>
                    <input type="number" id="fixedAmount" placeholder="æ¯åªå¯è½¬å€ºä¹°å…¥é‡‘é¢" value="10000">
                </div>
                <div class="config-item">
                    <label>äº¤æ˜“å•ç±»å‹</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="orderType" value="limit" checked>
                            é™ä»·å•
                        </label>
                        <label>
                            <input type="radio" name="orderType" value="market">
                            å¸‚ä»·å•
                        </label>
                    </div>
                </div>
                <div class="config-item">
                    <label for="notificationEmail">é€šçŸ¥é‚®ç®±ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="email" id="notificationEmail" placeholder="äº¤æ˜“å¼‚å¸¸æ—¶æ¥æ”¶é€šçŸ¥çš„é‚®ç®±">
                </div>
                <div class="config-item" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 10px;">
                    <label style="font-weight: 600; color: #2c3e50;">é€‰å€ºè°ƒä»“è°ƒåº¦è®¾ç½®</label>
                    <div style="margin-top: 10px;">
                        <label style="font-size: 12px; color: #666; margin-bottom: 8px; display: block;">è°ƒåº¦ç±»å‹</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="scheduleType" value="daily" checked>
                                æ¯å¤©
                            </label>
                            <label>
                                <input type="radio" name="scheduleType" value="weekly">
                                æ¯å‘¨
                            </label>
                            <label>
                                <input type="radio" name="scheduleType" value="monthly">
                                æ¯æœˆæŒ‡å®šæ—¥æœŸ
                            </label>
                        </div>
                    </div>
                    <div style="margin-top: 10px;" id="weeklyDayGroup" style="display: none;">
                        <label for="dayOfWeek" style="font-size: 12px; color: #666; margin-bottom: 5px; display: block;">é€‰æ‹©æ˜ŸæœŸï¼ˆå‘¨ä¸€åˆ°å‘¨äº”ï¼‰</label>
                        <select id="dayOfWeek" style="width: 120px;">
                            <option value="0">å‘¨ä¸€</option>
                            <option value="1">å‘¨äºŒ</option>
                            <option value="2">å‘¨ä¸‰</option>
                            <option value="3">å‘¨å››</option>
                            <option value="4">å‘¨äº”</option>
                        </select>
                    </div>
                    <div style="margin-top: 10px;" id="monthlyDateGroup" style="display: none;">
                        <label for="dayOfMonth" style="font-size: 12px; color: #666; margin-bottom: 5px; display: block;">æ¯æœˆæ—¥æœŸï¼ˆ1-31ï¼‰</label>
                        <input type="number" id="dayOfMonth" min="1" max="31" value="5" style="width: 100px;">
                    </div>
                    <div style="margin-top: 10px;">
                        <label for="scheduleTime" style="font-size: 12px; color: #666; margin-bottom: 5px; display: block;">æ‰§è¡Œæ—¶é—´</label>
                        <input type="time" id="scheduleTime" value="14:50" style="width: 120px;">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeModal('configModal')">å–æ¶ˆ</button>
                    <button type="submit" class="btn-primary">ä¿å­˜é…ç½®</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å¸®åŠ©æ–‡æ¡£æ¨¡æ€æ¡† -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('helpModal')">Ã—</button>
            <h1>å¸®åŠ©æ–‡æ¡£</h1>
            
            <div class="help-section">
                <h2>ğŸ“– æ“ä½œæŒ‡å—</h2>
                <p><strong>1. ç™»å½•ç³»ç»Ÿ</strong> - ä½¿ç”¨ç­–ç•¥å¹³å°æä¾›çš„è´¦å·å¯†ç ç™»å½•ã€‚</p>
                <p><strong>2. é€‰æ‹©ç­–ç•¥</strong> - ç‚¹å‡»"é€‰æ‹©ç­–ç•¥"ï¼Œé€‰æ‹©è¦ä½¿ç”¨çš„äº¤æ˜“ç­–ç•¥å’Œå›æµ‹è®°å½•ã€‚</p>
                <p><strong>3. é…ç½®ä¿¡æ¯</strong> - ç‚¹å‡»"è®¾ç½®"ï¼Œé…ç½® MiniQMT ç¨‹åºè·¯å¾„ã€è¯åˆ¸è´¦å·ç­‰ã€‚</p>
                <p><strong>4. å¯åŠ¨äº¤æ˜“</strong> - ç‚¹å‡»"è¿è¡Œ"å¯åŠ¨è‡ªåŠ¨äº¤æ˜“ï¼Œç³»ç»Ÿå°†æŒ‰ç­–ç•¥è‡ªåŠ¨æ‰§è¡Œã€‚</p>
            </div>

            <div class="help-section">
                <h2>â“ å¸¸è§é—®é¢˜</h2>
                <p><strong>Q: å¦‚ä½•è·å– MiniQMT è·¯å¾„ï¼Ÿ</strong></p>
                <p>A: æ‰¾åˆ° MiniQMT å®‰è£…ç›®å½•ä¸‹çš„ userdata_mini æ–‡ä»¶å¤¹è·¯å¾„ã€‚</p>
                <p><strong>Q: æ­¢ç›ˆæ­¢æŸå¦‚ä½•å·¥ä½œï¼Ÿ</strong></p>
                <p>A: ç³»ç»Ÿæ¯åˆ†é’Ÿæ£€æŸ¥æŒä»“ï¼Œæ»¡è¶³æ¡ä»¶æ—¶è‡ªåŠ¨æ‰§è¡Œå–å‡ºã€‚</p>
            </div>

            <div class="help-section">
                <h2>ğŸ”— è”ç³»æˆ‘ä»¬</h2>
                <p>å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æœ¬åœ°æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // ==================== é£é™©æç¤º ====================
        document.getElementById('riskDisclaimerConfirm').addEventListener('click', function() {
            document.getElementById('riskDisclaimerOverlay').style.display = 'none';
        });

        // ==================== è„šæœ¬å¼€å§‹æ‰§è¡Œæ ‡è®° ====================
        console.log('[è„šæœ¬] JavaScript è„šæœ¬å¼€å§‹æ‰§è¡Œ');
        
        // ==================== JavaScript é”™è¯¯æ•è·å’Œæ—¥å¿—è®°å½• ====================
        // æ•è·å…¨å±€ JavaScript é”™è¯¯
        window.addEventListener('error', function(event) {
            var errorInfo = {
                message: event.message || 'æœªçŸ¥é”™è¯¯',
                source: event.filename || 'æœªçŸ¥æ–‡ä»¶',
                lineno: event.lineno || 0,
                colno: event.colno || 0,
                error: event.error ? event.error.toString() : null,
                stack: event.error && event.error.stack ? event.error.stack : null,
                timestamp: new Date().toISOString()
            };
            
            console.error('JavaScript é”™è¯¯:', errorInfo);
            
            // å°è¯•å‘é€åˆ°åç«¯è®°å½•
            try {
                if (window.pywebview && window.pywebview.api && typeof window.pywebview.api.log_js_error === 'function') {
                    var logPromise = window.pywebview.api.log_js_error(
                        errorInfo.message,
                        errorInfo.source,
                        errorInfo.lineno,
                        errorInfo.colno,
                        errorInfo.error,
                        errorInfo.stack
                    );
                    if (logPromise && typeof logPromise.catch === 'function') {
                        logPromise.catch(function(err) {
                            console.error('å‘é€é”™è¯¯æ—¥å¿—å¤±è´¥:', err);
                        });
                    }
                }
            } catch (e) {
                console.error('è®°å½•é”™è¯¯æ—¥å¿—å¼‚å¸¸:', e);
            }
            
            // åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºé”™è¯¯ï¼ˆå¦‚æœç™»å½•å®¹å™¨å­˜åœ¨ï¼‰
            try {
                var errorEl = document.getElementById('loginError');
                if (errorEl) {
                    errorEl.textContent = 'é¡µé¢é”™è¯¯: ' + errorInfo.message + ' (æŸ¥çœ‹æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯)';
                    errorEl.style.display = 'block';
                }
            } catch (e) {
                // å¿½ç•¥æ˜¾ç¤ºé”™è¯¯
            }
        });
        
        // æ•è·æœªå¤„ç†çš„ Promise æ‹’ç»ï¼ˆå¦‚æœæ”¯æŒï¼‰
        if (window.addEventListener) {
            window.addEventListener('unhandledrejection', function(event) {
                var errorInfo = {
                    message: event.reason ? (event.reason.message || event.reason.toString()) : 'æœªå¤„ç†çš„ Promise æ‹’ç»',
                    stack: event.reason && event.reason.stack ? event.reason.stack : null,
                    timestamp: new Date().toISOString()
                };
                
                console.error('æœªå¤„ç†çš„ Promise æ‹’ç»:', errorInfo);
                
                // å°è¯•å‘é€åˆ°åç«¯è®°å½•
                try {
                    if (window.pywebview && window.pywebview.api && typeof window.pywebview.api.log_js_error === 'function') {
                        var logPromise = window.pywebview.api.log_js_error(
                            errorInfo.message,
                            'Promise',
                            0,
                            0,
                            errorInfo.message,
                            errorInfo.stack
                        );
                        if (logPromise && typeof logPromise.catch === 'function') {
                            logPromise.catch(function(err) {
                                console.error('å‘é€é”™è¯¯æ—¥å¿—å¤±è´¥:', err);
                            });
                        }
                    }
                } catch (e) {
                    console.error('è®°å½•é”™è¯¯æ—¥å¿—å¼‚å¸¸:', e);
                }
            });
        }
        
        // é‡å†™ console.error ä»¥æ•è·æ‰€æœ‰ console.error è°ƒç”¨
        var originalConsoleError = console.error;
        console.error = function() {
            var args = Array.prototype.slice.call(arguments);
            originalConsoleError.apply(console, args);
            
            // å°è¯•å‘é€åˆ°åç«¯è®°å½•
            try {
                if (window.pywebview && window.pywebview.api && typeof window.pywebview.api.log_js_error === 'function') {
                    var errorMsg = args.map(function(arg) {
                        if (typeof arg === 'object') {
                            try {
                                return JSON.stringify(arg);
                            } catch(e) {
                                return String(arg);
                            }
                        }
                        return String(arg);
                    }).join(' ');
                    
                    var logPromise = window.pywebview.api.log_js_error(
                        errorMsg,
                        'console.error',
                        0,
                        0,
                        errorMsg,
                        null
                    );
                    if (logPromise && typeof logPromise.catch === 'function') {
                        logPromise.catch(function(err) {
                            // å¿½ç•¥å‘é€å¤±è´¥
                        });
                    }
                }
            } catch (e) {
                // å¿½ç•¥è®°å½•å¼‚å¸¸
            }
        };
        
        // ==================== å…¨å±€çŠ¶æ€ ====================
        var currentUser = null;
        var selectedStrategyId = null;
        var selectedStrategyName = null;
        var selectedHistoryId = null;
        var selectedHistoryNote = null;
        var isRunning = false;
        var strategyPage = 1;
        var backtestPage = 1;

        // ==================== PyWebView API è°ƒç”¨å°è£… ====================
        function callApi(method) {
            var startTime = Date.now();
            var logError = null;
            var args = Array.prototype.slice.call(arguments, 1);
            
            // è¿”å› Promise
            return new Promise(function(resolve, reject) {
                // ç­‰å¾… pywebview å°±ç»ªï¼ˆæœ€å¤šç­‰å¾…10ç§’ï¼‰
                var attempts = 0;
                var maxAttempts = 100; // 10ç§’
                
                function waitForApi() {
                    if ((window.pywebview && window.pywebview.api) || attempts >= maxAttempts) {
                        checkAndCall();
                    } else {
                        attempts++;
                        setTimeout(waitForApi, 100);
                    }
                }
                
                function checkAndCall() {
                    if (!window.pywebview || !window.pywebview.api) {
                        var errorMsg = 'PyWebView API æœªå°±ç»ª: ' + method;
                        console.error(errorMsg);
                        logError = errorMsg;
                        tryLogJsError(errorMsg, 'callApi', 0, 0, errorMsg, null);
                        resolve({ success: false, error: 'PyWebView API æœªå°±ç»ªï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•' });
                        return;
                    }
                    
                    // æ£€æŸ¥æ–¹æ³•æ˜¯å¦å­˜åœ¨
                    if (typeof window.pywebview.api[method] !== 'function') {
                        var errorMsg = 'API æ–¹æ³•ä¸å­˜åœ¨: ' + method;
                        console.error(errorMsg);
                        logError = errorMsg;
                        tryLogJsError(errorMsg, 'callApi', 0, 0, errorMsg, null);
                        resolve({ success: false, error: 'API æ–¹æ³• ' + method + ' ä¸å­˜åœ¨' });
                        return;
                    }
                    
                    // è®°å½• API è°ƒç”¨å¼€å§‹ï¼ˆæ•æ„Ÿä¿¡æ¯ä¸è®°å½•ï¼‰
                    var safeArgs = method === 'login' 
                        ? [args[0], '***'].concat(args.slice(2))  // éšè—å¯†ç 
                        : args;
                    console.log('[APIè°ƒç”¨] ' + method, safeArgs);
                    
                    // è°ƒç”¨ API
                    try {
                        var apiResult = window.pywebview.api[method].apply(window.pywebview.api, args);
                        
                        // å¤„ç† Promise ç»“æœ
                        if (apiResult && typeof apiResult.then === 'function') {
                            apiResult.then(function(result) {
                                var duration = Date.now() - startTime;
                                console.log('[APIç»“æœ] ' + method + ' (' + duration + 'ms)', result);
                                processResult(result);
                            }).catch(function(error) {
                                var duration = Date.now() - startTime;
                                var errorMsg = 'API è°ƒç”¨å¼‚å¸¸: ' + method + ' - ' + (error.message || error.toString());
                                console.error('[APIå¼‚å¸¸] ' + method + ' (' + duration + 'ms)', error);
                                logError = errorMsg;
                                tryLogJsError(errorMsg, 'callApi', 0, 0, error.toString(), error.stack || null);
                                resolve({ success: false, error: 'API è°ƒç”¨å¼‚å¸¸: ' + (error.message || error.toString() || 'è°ƒç”¨å¤±è´¥') });
                            });
                        } else {
                            // åŒæ­¥è¿”å›ç»“æœ
                            var duration = Date.now() - startTime;
                            console.log('[APIç»“æœ] ' + method + ' (' + duration + 'ms)', apiResult);
                            processResult(apiResult);
                        }
                    } catch (error) {
                        var duration = Date.now() - startTime;
                        var errorMsg = 'API è°ƒç”¨å¼‚å¸¸: ' + method + ' - ' + (error.message || error.toString());
                        console.error('[APIå¼‚å¸¸] ' + method + ' (' + duration + 'ms)', error);
                        logError = errorMsg;
                        tryLogJsError(errorMsg, 'callApi', 0, 0, error.toString(), error.stack || null);
                        resolve({ success: false, error: 'API è°ƒç”¨å¼‚å¸¸: ' + (error.message || error.toString() || 'è°ƒç”¨å¤±è´¥') });
                    }
                }
                
                function processResult(result) {
                    // ç¡®ä¿è¿”å›ç»“æœæœ‰æ­£ç¡®çš„æ ¼å¼
                    if (result === null || result === undefined) {
                        var errorMsg = 'API è°ƒç”¨è¿”å›ç©ºå€¼: ' + method;
                        console.error(errorMsg);
                        logError = errorMsg;
                        tryLogJsError(errorMsg, 'callApi', 0, 0, errorMsg, null);
                        resolve({ success: false, error: 'API è°ƒç”¨è¿”å›ç©ºå€¼ï¼Œè¯·æ£€æŸ¥åç«¯æ—¥å¿—' });
                        return;
                    }
                    
                    // å¦‚æœè¿”å›ç»“æœæ²¡æœ‰ success å­—æ®µï¼Œå°è¯•åŒ…è£…
                    if (typeof result !== 'object' || !('success' in result)) {
                        var errorMsg = 'API è¿”å›æ ¼å¼å¼‚å¸¸: ' + method + ' - ' + JSON.stringify(result);
                        console.warn(errorMsg);
                        logError = errorMsg;
                        tryLogJsError(errorMsg, 'callApi', 0, 0, errorMsg, null);
                        resolve({ success: false, error: 'API è¿”å›æ ¼å¼å¼‚å¸¸: ' + JSON.stringify(result) });
                        return;
                    }
                    
                    // å¦‚æœè°ƒç”¨å¤±è´¥ï¼Œè®°å½•é”™è¯¯
                    if (!result.success && result.error) {
                        var errorMsg = '[APIå¤±è´¥] ' + method + ': ' + result.error;
                        console.error(errorMsg);
                        tryLogJsError(errorMsg, 'callApi', 0, 0, result.error, null);
                    }
                    
                    resolve(result);
                }
                
                // å¼€å§‹ç­‰å¾… API
                waitForApi();
            });
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šå°è¯•è®°å½• JavaScript é”™è¯¯
        function tryLogJsError(message, source, lineno, colno, error, stack) {
            try {
                // å…ˆå°è¯•ç›´æ¥è°ƒç”¨ï¼ˆåŒæ­¥æ–¹å¼ï¼Œä¸ç­‰å¾…ï¼‰
                if (window.pywebview && window.pywebview.api) {
                    if (typeof window.pywebview.api.log_js_error === 'function') {
                        // ä½¿ç”¨ Promiseï¼Œä½†ä¸ç­‰å¾…ç»“æœï¼ˆé¿å…é˜»å¡ï¼‰
                        var promise = window.pywebview.api.log_js_error(message, source, lineno, colno, error, stack);
                        if (promise && typeof promise.catch === 'function') {
                            promise.catch(function(err) {
                                console.error('[æ—¥å¿—] å‘é€é”™è¯¯æ—¥å¿—å¤±è´¥:', err);
                            });
                        }
                    } else {
                        console.warn('[æ—¥å¿—] log_js_error æ–¹æ³•ä¸å­˜åœ¨');
                    }
                } else {
                    // API æœªå°±ç»ªæ—¶ï¼Œåªè®°å½•åˆ° console
                    console.log('[æ—¥å¿—] API æœªå°±ç»ªï¼Œæ— æ³•å‘é€åˆ°åç«¯:', message);
                }
            } catch (e) {
                console.error('[æ—¥å¿—] è®°å½•é”™è¯¯æ—¥å¿—å¼‚å¸¸:', e);
            }
        }
        
        // ç«‹å³æµ‹è¯•ï¼šå°è¯•è®°å½•è„šæœ¬æ‰§è¡Œ
        setTimeout(function() {
            tryLogJsError('[è„šæœ¬] JavaScript è„šæœ¬å·²åŠ è½½å¹¶å¼€å§‹æ‰§è¡Œ', 'script', 0, 0, '', null);
        }, 100);

        // ==================== åˆå§‹åŒ– ====================
        window.addEventListener('DOMContentLoaded', function() {
            console.log('[åˆå§‹åŒ–] é¡µé¢åŠ è½½å®Œæˆï¼Œç­‰å¾… PyWebView...');
            tryLogJsError('[åˆå§‹åŒ–] é¡µé¢åŠ è½½å®Œæˆ', 'DOMContentLoaded', 0, 0, '', null);
            
            // ç­‰å¾… PyWebView å°±ç»ª
            var attempts = 0;
            var maxAttempts = 50;
            
            function waitForPyWebView() {
                if (window.pywebview || attempts >= maxAttempts) {
                    if (!window.pywebview) {
                        var errorMsg = 'PyWebView æœªå°±ç»ªï¼ˆç­‰å¾…è¶…æ—¶ï¼‰';
                        console.error(errorMsg);
                        tryLogJsError(errorMsg, 'DOMContentLoaded', 0, 0, errorMsg, null);
                        return;
                    }
                    
                    console.log('[åˆå§‹åŒ–] PyWebView å¯¹è±¡å­˜åœ¨');
                    waitForApi();
                } else {
                    attempts++;
                    setTimeout(waitForPyWebView, 100);
                }
            }
            
            function waitForApi() {
                attempts = 0;
                function checkApi() {
                    if (window.pywebview.api || attempts >= maxAttempts) {
                        if (!window.pywebview.api) {
                            var errorMsg = 'PyWebView API æœªå°±ç»ªï¼ˆç­‰å¾…è¶…æ—¶ï¼‰';
                            console.error(errorMsg);
                            tryLogJsError(errorMsg, 'DOMContentLoaded', 0, 0, errorMsg, null);
                            return;
                        }
                        
                        console.log('[åˆå§‹åŒ–] PyWebView API å·²å°±ç»ª');
                        tryLogJsError('[åˆå§‹åŒ–] PyWebView API å·²å°±ç»ª', 'DOMContentLoaded', 0, 0, '', null);
                        
                        // æµ‹è¯• API è¿æ¥
                        testApiConnection();
                    } else {
                        attempts++;
                        setTimeout(checkApi, 100);
                    }
                }
                checkApi();
            }
            
            function testApiConnection() {
                console.log('[åˆå§‹åŒ–] æµ‹è¯• API è¿æ¥...');
                callApi('get_version').then(function(testResult) {
                    console.log('[åˆå§‹åŒ–] API æµ‹è¯•ç»“æœ:', testResult);
                    if (testResult && testResult.success) {
                        tryLogJsError('[åˆå§‹åŒ–] API è¿æ¥æµ‹è¯•æˆåŠŸ', 'DOMContentLoaded', 0, 0, '', null);
                    } else {
                        var errorMsg = testResult && testResult.error ? testResult.error : 'æœªçŸ¥é”™è¯¯';
                        tryLogJsError('[åˆå§‹åŒ–] API è¿æ¥æµ‹è¯•å¤±è´¥: ' + errorMsg, 'DOMContentLoaded', 0, 0, JSON.stringify(testResult), null);
                    }
                    checkSavedAuth();
                }).catch(function(e) {
                    console.error('[åˆå§‹åŒ–] API æµ‹è¯•å¼‚å¸¸:', e);
                    tryLogJsError('[åˆå§‹åŒ–] API æµ‹è¯•å¼‚å¸¸: ' + e.toString(), 'DOMContentLoaded', 0, 0, e.toString(), e.stack || null);
                    checkSavedAuth();
                });
            }
            
            function checkSavedAuth() {
                console.log('[åˆå§‹åŒ–] æ£€æŸ¥ä¿å­˜çš„ç™»å½•ä¿¡æ¯...');
                callApi('get_saved_auth').then(function(authResult) {
                    console.log('[åˆå§‹åŒ–] è·å–ç™»å½•ä¿¡æ¯ç»“æœ:', authResult);
                    
                    if (authResult && authResult.success && authResult.data) {
                        document.getElementById('username').value = authResult.data.username || '';
                        document.getElementById('password').value = authResult.data.password || '';
                        document.getElementById('rememberPassword').checked = authResult.data.remember_password;
                        document.getElementById('autoLogin').checked = authResult.data.auto_login;
                        
                        // è‡ªåŠ¨ç™»å½•
                        if (authResult.data.auto_login && authResult.data.username) {
                            console.log('[åˆå§‹åŒ–] å°è¯•è‡ªåŠ¨ç™»å½•...');
                            callApi('auto_login_with_token').then(function(autoResult) {
                                console.log('[åˆå§‹åŒ–] è‡ªåŠ¨ç™»å½•ç»“æœ:', autoResult);
                                if (autoResult && autoResult.success && autoResult.data && autoResult.data.success) {
                                    currentUser = autoResult.data.username;
                                    showMainContainer();
                                }
                            }).catch(function(e) {
                                console.error('[åˆå§‹åŒ–] è‡ªåŠ¨ç™»å½•å¼‚å¸¸:', e);
                            });
                        }
                    }
                }).catch(function(e) {
                    console.error('[åˆå§‹åŒ–] æ£€æŸ¥ç™»å½•ä¿¡æ¯å¼‚å¸¸:', e);
                    tryLogJsError('[åˆå§‹åŒ–] æ£€æŸ¥ç™»å½•ä¿¡æ¯å¼‚å¸¸: ' + e.toString(), 'DOMContentLoaded', 0, 0, e.toString(), e.stack || null);
                });
            }
            
            // å¼€å§‹ç­‰å¾…
            waitForPyWebView();
        });

        // ==================== ç™»å½•åŠŸèƒ½ ====================
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            console.log('[ç™»å½•] è¡¨å•æäº¤äº‹ä»¶è§¦å‘');
            tryLogJsError('[ç™»å½•] è¡¨å•æäº¤äº‹ä»¶è§¦å‘', 'loginForm.submit', 0, 0, '', null);
            
            var usernameInput = document.getElementById('username');
            var passwordInput = document.getElementById('password');
            var username = usernameInput.value.trim();
            var password = passwordInput.value;
            var remember = document.getElementById('rememberPassword').checked;
            var autoLogin = document.getElementById('autoLogin').checked;
            
            var loginBtn = document.getElementById('loginBtn');
            var errorEl = document.getElementById('loginError');
            
            console.log('[ç™»å½•] è¾“å…¥éªŒè¯ - ç”¨æˆ·åé•¿åº¦:', username.length, 'å¯†ç é•¿åº¦:', password.length);
            
            // éªŒè¯è¾“å…¥
            if (!username) {
                var errorMsg = 'è¯·è¾“å…¥ç”¨æˆ·å';
                errorEl.textContent = errorMsg;
                errorEl.style.display = 'block';
                console.warn('[ç™»å½•] éªŒè¯å¤±è´¥:', errorMsg);
                tryLogJsError('[ç™»å½•] éªŒè¯å¤±è´¥: ' + errorMsg, 'loginForm.submit', 0, 0, '', null);
                return;
            }
            if (!password) {
                var errorMsg = 'è¯·è¾“å…¥å¯†ç ';
                errorEl.textContent = errorMsg;
                errorEl.style.display = 'block';
                console.warn('[ç™»å½•] éªŒè¯å¤±è´¥:', errorMsg);
                tryLogJsError('[ç™»å½•] éªŒè¯å¤±è´¥: ' + errorMsg, 'loginForm.submit', 0, 0, '', null);
                return;
            }
            
            // ä¿å­˜è¾“å…¥å€¼ï¼ˆé˜²æ­¢åœ¨ API è°ƒç”¨è¿‡ç¨‹ä¸­è¢«æ¸…ç©ºï¼‰
            var savedUsername = username;
            var savedPassword = password;
            
            console.log('[ç™»å½•] å‡†å¤‡è°ƒç”¨ç™»å½• API - ç”¨æˆ·å:', savedUsername, 'remember:', remember, 'autoLogin:', autoLogin);
            tryLogJsError('[ç™»å½•] å‡†å¤‡è°ƒç”¨ç™»å½• API', 'loginForm.submit', 0, 0, 'ç”¨æˆ·å: ' + savedUsername + ', remember: ' + remember + ', autoLogin: ' + autoLogin, null);
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span class="loading"></span>ç™»å½•ä¸­...';
            errorEl.style.display = 'none';
            
            console.log('[ç™»å½•] å¼€å§‹è°ƒç”¨ callApi("login", ...)');
            var callStartTime = Date.now();
            callApi('login', savedUsername, savedPassword, remember, autoLogin).then(function(result) {
                var callDuration = Date.now() - callStartTime;
                console.log('[ç™»å½•] callApi è¿”å› (è€—æ—¶ ' + callDuration + 'ms):', result);
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                loginBtn.disabled = false;
                loginBtn.textContent = 'ç™»å½•';
                
                // æ£€æŸ¥ç»“æœ
                if (!result) {
                    var errorMsg = 'ç™»å½•å¤±è´¥ï¼šæœªæ”¶åˆ°æœåŠ¡å™¨å“åº”';
                    console.error('[ç™»å½•]', errorMsg);
                    tryLogJsError('[ç™»å½•] ' + errorMsg, 'loginForm.submit', 0, 0, '', null);
                    errorEl.textContent = errorMsg;
                    errorEl.style.display = 'block';
                    // æ¢å¤è¾“å…¥æ¡†å€¼
                    usernameInput.value = savedUsername;
                    passwordInput.value = savedPassword;
                    return;
                }
                
                console.log('[ç™»å½•] æ£€æŸ¥è¿”å›ç»“æœ - success:', result.success, 'error:', result.error);
                
                if (result.success) {
                    if (result.data && result.data.username) {
                        console.log('[ç™»å½•] ç™»å½•æˆåŠŸï¼Œç”¨æˆ·å:', result.data.username);
                        tryLogJsError('[ç™»å½•] ç™»å½•æˆåŠŸ: ' + result.data.username, 'loginForm.submit', 0, 0, '', null);
                        currentUser = result.data.username;
                        showMainContainer();
                    } else {
                        var errorMsg = 'ç™»å½•å¤±è´¥ï¼šè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸';
                        console.error('[ç™»å½•]', errorMsg, result);
                        tryLogJsError('[ç™»å½•] ' + errorMsg, 'loginForm.submit', 0, 0, JSON.stringify(result), null);
                        errorEl.textContent = errorMsg;
                        errorEl.style.display = 'block';
                        // æ¢å¤è¾“å…¥æ¡†å€¼
                        usernameInput.value = savedUsername;
                        passwordInput.value = savedPassword;
                    }
                } else {
                    // ç™»å½•å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    var errorMsg = result.error || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ';
                    console.error('[ç™»å½•] ç™»å½•å¤±è´¥:', errorMsg);
                    tryLogJsError('[ç™»å½•] ç™»å½•å¤±è´¥: ' + errorMsg, 'loginForm.submit', 0, 0, errorMsg, null);
                    errorEl.textContent = errorMsg;
                    errorEl.style.display = 'block';
                    // æ¢å¤è¾“å…¥æ¡†å€¼ï¼ˆä¸æ¸…ç©ºï¼‰
                    usernameInput.value = savedUsername;
                    passwordInput.value = savedPassword;
                }
            }).catch(function(error) {
                // æ•è·æ‰€æœ‰å¼‚å¸¸
                var errorMsg = 'ç™»å½•è¿‡ç¨‹å‘ç”Ÿå¼‚å¸¸: ' + (error.message || error.toString());
                console.error('[ç™»å½•] å¼‚å¸¸:', error);
                tryLogJsError('[ç™»å½•] å¼‚å¸¸: ' + errorMsg, 'loginForm.submit', 0, 0, error.toString(), error.stack || null);
                loginBtn.disabled = false;
                loginBtn.textContent = 'ç™»å½•';
                errorEl.textContent = errorMsg;
                errorEl.style.display = 'block';
                // æ¢å¤è¾“å…¥æ¡†å€¼
                usernameInput.value = savedUsername;
                passwordInput.value = savedPassword;
            });
        });

        function showMainContainer() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'flex';
            document.getElementById('userInfo').textContent = 'ç”¨æˆ·ï¼š' + currentUser;
            
            // åŠ è½½é…ç½®å’ŒçŠ¶æ€
            loadConfig();
            loadCurrentStrategy();
            loadTradingStatus();
            
            // å®šæ—¶åˆ·æ–°
            setInterval(refreshData, 5000);
        }

        // ==================== ç­–ç•¥é€‰æ‹© ====================
        document.getElementById('selectStrategyBtn').addEventListener('click', function() {
            document.getElementById('strategyModal').style.display = 'flex';
            loadStrategies();
        });

        function loadStrategies(page) {
            page = page || 1;
            strategyPage = page;
            var listEl = document.getElementById('strategyList');
            listEl.innerHTML = '<li class="empty-tip">åŠ è½½ä¸­...</li>';
            
            callApi('get_strategies', page, 10).then(function(result) {
                if (result.success && result.data) {
                    var items = result.data.items;
                    var total_pages = result.data.total_pages;
                    
                    if (items.length === 0) {
                        listEl.innerHTML = '<li class="empty-tip">æš‚æ— ç­–ç•¥</li>';
                    } else {
                        listEl.innerHTML = items.map(function(item) {
                            return '<li class="strategy-item" data-id="' + item.id + '" data-name="' + item.name + '">' +
                                item.name +
                                '<span style="color:#999;font-size:11px;margin-left:8px;">(' + item.backtest_count + 'æ¬¡å›æµ‹)</span>' +
                                '</li>';
                        }).join('');
                        
                        // ç»‘å®šç‚¹å‡»äº‹ä»¶
                        listEl.querySelectorAll('.strategy-item').forEach(function(item) {
                            item.addEventListener('click', function() {
                                selectStrategy(item);
                            });
                        });
                    }
                    
                    // æ¸²æŸ“åˆ†é¡µ
                    renderPagination('strategyPagination', page, total_pages, loadStrategies);
                } else {
                    listEl.innerHTML = '<li class="empty-tip">' + (result.error || 'åŠ è½½å¤±è´¥') + '</li>';
                }
            }).catch(function(error) {
                listEl.innerHTML = '<li class="empty-tip">åŠ è½½å¤±è´¥: ' + error.toString() + '</li>';
            });
        }

        function selectStrategy(item) {
            document.querySelectorAll('#strategyList .strategy-item').forEach(function(i) {
                i.classList.remove('active');
            });
            item.classList.add('active');
            
            selectedStrategyId = parseInt(item.dataset.id);
            selectedStrategyName = item.dataset.name;
            
            // åŠ è½½å›æµ‹è®°å½•
            loadBacktestHistories(selectedStrategyId);
        }

        function loadBacktestHistories(strategyId, page) {
            page = page || 1;
            backtestPage = page;
            var panel = document.getElementById('backtestPanel');
            var listEl = document.getElementById('backtestList');
            
            panel.classList.remove('disabled');
            listEl.innerHTML = '<p class="empty-tip">åŠ è½½ä¸­...</p>';
            
            callApi('get_backtest_histories', strategyId, page, 10).then(function(result) {
                if (result.success && result.data) {
                    var items = result.data.items;
                    var total_pages = result.data.total_pages;
                    
                    if (items.length === 0) {
                        listEl.innerHTML = '<p class="empty-tip">æš‚æ— å›æµ‹è®°å½•</p>';
                    } else {
                        listEl.innerHTML = items.map(function(item) {
                            var returnStr = item.strategy_return != null ? 'æ”¶ç›Šç‡: ' + item.strategy_return.toFixed(2) + '%' : '';
                            var dateStr = item.backtest_time ? new Date(item.backtest_time).toLocaleDateString() : '';
                            return '<div class="backtest-item-detail" data-id="' + item.id + '" data-note="' + dateStr + ' ' + returnStr + '">' +
                                '<h3>' + (dateStr || 'å›æµ‹è®°å½• #' + item.id) + '</h3>' +
                                '<p>' + returnStr + (item.sharpe_ratio != null ? ' | å¤æ™®: ' + item.sharpe_ratio.toFixed(2) : '') + '</p>' +
                                '</div>';
                        }).join('');
                        
                        // ç»‘å®šç‚¹å‡»äº‹ä»¶
                        listEl.querySelectorAll('.backtest-item-detail').forEach(function(item) {
                            item.addEventListener('click', function() {
                                selectBacktest(item);
                            });
                        });
                    }
                    
                    // æ¸²æŸ“åˆ†é¡µ
                    renderPagination('backtestPagination', page, total_pages, function(p) {
                        loadBacktestHistories(strategyId, p);
                    });
                } else {
                    listEl.innerHTML = '<p class="empty-tip">' + (result.error || 'åŠ è½½å¤±è´¥') + '</p>';
                }
            }).catch(function(error) {
                listEl.innerHTML = '<p class="empty-tip">åŠ è½½å¤±è´¥: ' + error.toString() + '</p>';
            });
        }

        function selectBacktest(item) {
            document.querySelectorAll('.backtest-item-detail').forEach(function(i) {
                i.classList.remove('selected');
            });
            item.classList.add('selected');
            
            selectedHistoryId = parseInt(item.dataset.id);
            selectedHistoryNote = item.dataset.note;
            
            // ä¿å­˜ç­–ç•¥é€‰æ‹©
            callApi('select_strategy', selectedStrategyId, selectedStrategyName, selectedHistoryId, selectedHistoryNote).then(function(result) {
                if (result.success) {
                    updateStrategyDisplay();
                    closeModal('strategyModal');
                } else {
                    alert('é€‰æ‹©ç­–ç•¥å¤±è´¥: ' + result.error);
                }
            }).catch(function(error) {
                alert('é€‰æ‹©ç­–ç•¥å¤±è´¥: ' + error.toString());
            });
        }

        function updateStrategyDisplay() {
            var el = document.getElementById('currentStrategy');
            if (selectedStrategyName && selectedHistoryNote) {
                // è·å–è°ƒåº¦é…ç½®å¹¶æ˜¾ç¤º
                getScheduleDisplayText().then(function(scheduleText) {
                    if (scheduleText) {
                        el.textContent = selectedStrategyName + ' | ' + selectedHistoryNote + ' | ' + scheduleText;
                    } else {
                        el.textContent = selectedStrategyName + ' | ' + selectedHistoryNote;
                    }
                    el.classList.remove('empty');
                });
            } else {
                el.textContent = 'æœªé€‰æ‹©ç­–ç•¥';
                el.classList.add('empty');
            }
        }

        function getScheduleDisplayText() {
            return callApi('get_current_strategy').then(function(strategyResult) {
                if (strategyResult.success && strategyResult.data && strategyResult.data.execution_schedule) {
                    var schedule = strategyResult.data.execution_schedule;
                    var time = schedule.time || '14:50';
                    
                    if (schedule.type === 'daily') {
                        return 'æ¯å¤© ' + time;
                    } else if (schedule.type === 'weekly') {
                        var dayOfWeek = schedule.day_of_week || 0;
                        var days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
                        return 'æ¯å‘¨' + days[dayOfWeek] + ' ' + time;
                    } else if (schedule.type === 'monthly') {
                        var day = schedule.day_of_month || 5;
                        return 'æ¯æœˆ' + day + 'å· ' + time;
                    }
                }
                return null;
            });
        }

        function loadCurrentStrategy() {
            callApi('get_current_strategy').then(function(result) {
                if (result.success && result.data) {
                    selectedStrategyId = result.data.strategy_id;
                    selectedStrategyName = result.data.strategy_name;
                    selectedHistoryId = result.data.history_id;
                    selectedHistoryNote = result.data.history_note;
                    updateStrategyDisplay();
                    // åŒæ—¶æ›´æ–°è°ƒåº¦é…ç½®æ˜¾ç¤º
                    loadScheduleConfig();
                }
            });
        }

        function renderPagination(containerId, currentPage, totalPages, callback) {
            var container = document.getElementById(containerId);
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            var html = '';
            for (var i = 1; i <= totalPages; i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="(${callback.toString()})(${i})">${i}</button>`;
            }
            container.innerHTML = html;
        }

        // ==================== è¿è¡Œæ§åˆ¶ ====================
        document.getElementById('runBtn').addEventListener('click', function() {
            if (!isRunning) {
                startTrading();
            } else {
                stopTrading();
            }
        });

        function startTrading() {
            var runBtn = document.getElementById('runBtn');
            runBtn.disabled = true;
            runBtn.textContent = 'å¯åŠ¨ä¸­...';
            
            callApi('start_trading').then(function(result) {
                runBtn.disabled = false;
                
                if (result.success) {
                    isRunning = true;
                    runBtn.textContent = 'â¸ï¸ åœæ­¢';
                    runBtn.classList.add('running');
                    updateTradingStatusUI(true);
                } else {
                    alert('å¯åŠ¨å¤±è´¥: ' + result.error);
                    runBtn.textContent = 'â–¶ï¸ è¿è¡Œ';
                }
            }).catch(function(error) {
                runBtn.disabled = false;
                alert('å¯åŠ¨å¤±è´¥: ' + error.toString());
                runBtn.textContent = 'â–¶ï¸ è¿è¡Œ';
            });
        }

        function stopTrading() {
            var runBtn = document.getElementById('runBtn');
            runBtn.disabled = true;
            
            callApi('stop_trading').then(function(result) {
                runBtn.disabled = false;
                
                if (result.success) {
                    isRunning = false;
                    runBtn.textContent = 'â–¶ï¸ è¿è¡Œ';
                    runBtn.classList.remove('running');
                    updateTradingStatusUI(false);
                } else {
                    alert('åœæ­¢å¤±è´¥: ' + result.error);
                }
            }).catch(function(error) {
                runBtn.disabled = false;
                alert('åœæ­¢å¤±è´¥: ' + error.toString());
            });
        }

        function updateTradingStatusUI(running) {
            var statusEl = document.getElementById('tradingStatus');
            var statusTextEl = document.getElementById('tradingStatusText');
            var monitorEl = document.getElementById('monitorStatus');
            var monitorTextEl = document.getElementById('monitorStatusText');
            
            if (running) {
                statusEl.textContent = 'è¿è¡Œä¸­';
                statusTextEl.textContent = 'â— æ­£å¸¸è¿è¡Œ';
                statusTextEl.className = 'status status-running';
                monitorEl.textContent = 'ç›‘æ§ä¸­';
                monitorTextEl.textContent = 'æ¯1åˆ†é’Ÿæ£€æŸ¥';
            } else {
                statusEl.textContent = 'æœªè¿è¡Œ';
                statusTextEl.textContent = 'â— å·²åœæ­¢';
                statusTextEl.className = 'status status-stopped';
                monitorEl.textContent = 'æœªç›‘æ§';
                monitorTextEl.textContent = '-';
            }
        }

        function loadTradingStatus() {
            callApi('get_trading_status').then(function(result) {
                if (result.success && result.data) {
                    isRunning = result.data.running;
                    updateTradingStatusUI(isRunning);
                    
                    var runBtn = document.getElementById('runBtn');
                    if (isRunning) {
                        runBtn.textContent = 'â¸ï¸ åœæ­¢';
                        runBtn.classList.add('running');
                    } else {
                        runBtn.textContent = 'â–¶ï¸ è¿è¡Œ';
                        runBtn.classList.remove('running');
                    }
                }
            });
        }

        // ==================== æ•°æ®åˆ·æ–° ====================
        function refreshData() {
            refreshAsset();
            refreshPositions();
            refreshLogs();
        }

        function refreshAsset() {
            callApi('get_asset').then(function(result) {
                if (result.success && result.data) {
                    document.getElementById('availableCash').textContent = 'Â¥' + result.data.cash.toLocaleString();
                }
            });
        }

        function refreshPositions() {
            callApi('get_positions').then(function(result) {
                var tbody = document.getElementById('holdingsTableBody');
                var totalProfitLossEl = document.getElementById('totalProfitLoss');
                var profitLossYieldEl = document.getElementById('profitLossYield');

                if (result.success && result.data && result.data.length > 0) {
                    document.getElementById('positionCount').textContent = result.data.length;

                    var totalProfitLoss = result.data.reduce(function(sum, pos) { return sum + pos.profit_loss; }, 0);
                    var totalCost = result.data.reduce(function(sum, pos) { return sum + pos.avg_price * pos.volume; }, 0);
                    var profitLossYield = totalCost > 0 ? totalProfitLoss / totalCost : 0;

                    var profitSign = totalProfitLoss >= 0 ? '+' : '';
                    totalProfitLossEl.textContent = 'Â¥' + profitSign + totalProfitLoss.toFixed(2);
                    totalProfitLossEl.className = 'value ' + (totalProfitLoss >= 0 ? 'profit-positive' : 'profit-negative');
                    profitLossYieldEl.textContent = (profitLossYield * 100).toFixed(2) + '%';
                    profitLossYieldEl.className = 'value ' + (profitLossYield >= 0 ? 'profit-positive' : 'profit-negative');

                    tbody.innerHTML = result.data.map(function(pos) {
                        var profitClass = pos.profit_loss >= 0 ? 'profit-positive' : 'profit-negative';
                        var profitSign = pos.profit_loss >= 0 ? '+' : '';
                        return '<tr>' +
                            '<td>' + pos.stock_code + '</td>' +
                            '<td>' + (pos.stock_name || '-') + '</td>' +
                            '<td>' + pos.volume + '</td>' +
                            '<td>' + pos.avg_price.toFixed(3) + '</td>' +
                            '<td>' + pos.current_price.toFixed(3) + '</td>' +
                            '<td class="' + profitClass + '">' + profitSign + pos.profit_loss.toFixed(2) + '</td>' +
                            '<td>' + pos.stop_profit_price.toFixed(3) + '</td>' +
                            '<td>' + pos.stop_loss_price.toFixed(3) + '</td>' +
                            '</tr>';
                    }).join('');
                } else {
                    document.getElementById('positionCount').textContent = '0';
                    totalProfitLossEl.textContent = 'Â¥0';
                    totalProfitLossEl.className = 'value';
                    profitLossYieldEl.textContent = '0%';
                    profitLossYieldEl.className = 'value';
                    tbody.innerHTML = '<tr><td colspan="8" class="empty-tip">æš‚æ— æŒä»“æ•°æ®</td></tr>';
                }
            });
        }

        function refreshLogs() {
            callApi('get_logs', 50).then(function(result) {
                if (result.success && result.data) {
                    var logArea = document.getElementById('logArea');
                    logArea.innerHTML = result.data.map(function(log) {
                        return '<div class="log-entry">' +
                            '<span class="log-time">[' + log.time + ']</span>' +
                            '<span class="log-' + log.level + '">[' + log.level + ']</span> ' + log.message +
                            '</div>';
                    }).join('');
                }
            });
        }

        // ==================== é…ç½®ç®¡ç† ====================
        document.getElementById('configBtn').addEventListener('click', function() {
            document.getElementById('configModal').style.display = 'flex';
            loadConfig(); // æ‰“å¼€æ—¶åŠ è½½é…ç½®
        });

        document.querySelectorAll('input[name="buyAmountType"]').forEach(function(radio) {
            radio.addEventListener('change', function(e) {
                document.getElementById('fixedAmountGroup').style.display = 
                    e.target.value === 'fixed' ? 'block' : 'none';
            });
        });

        // è°ƒåº¦ç±»å‹åˆ‡æ¢æ—¶æ˜¾ç¤º/éšè—æ¯æœˆæ—¥æœŸè¾“å…¥æ¡†å’Œæ¯å‘¨æ—¥æœŸé€‰æ‹©æ¡†
        document.querySelectorAll('input[name="scheduleType"]').forEach(function(radio) {
            radio.addEventListener('change', function(e) {
                var monthlyGroup = document.getElementById('monthlyDateGroup');
                var weeklyGroup = document.getElementById('weeklyDayGroup');
                monthlyGroup.style.display = e.target.value === 'monthly' ? 'block' : 'none';
                weeklyGroup.style.display = e.target.value === 'weekly' ? 'block' : 'none';
            });
        });

        document.getElementById('configForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            var config = {
                qmt_path: document.getElementById('qmtPath').value,
                account_id: document.getElementById('accountId').value,
                buy_amount_type: document.querySelector('input[name="buyAmountType"]:checked').value,
                fixed_amount: parseFloat(document.getElementById('fixedAmount').value) || 10000,
                order_type: document.querySelector('input[name="orderType"]:checked').value,
                notification_email: document.getElementById('notificationEmail').value
            };
            
            callApi('save_config', config).then(function(configResult) {
                if (!configResult.success) {
                    alert('ä¿å­˜é…ç½®å¤±è´¥: ' + configResult.error);
                    return;
                }
                
                // ä¿å­˜è°ƒåº¦é…ç½®
                var scheduleType = document.querySelector('input[name="scheduleType"]:checked').value;
                var scheduleTime = document.getElementById('scheduleTime').value;
                var execution_schedule = {
                    type: scheduleType,
                    time: scheduleTime
                };
                
                if (scheduleType === 'weekly') {
                    var dayOfWeek = parseInt(document.getElementById('dayOfWeek').value) || 0;
                    execution_schedule.day_of_week = dayOfWeek;
                } else if (scheduleType === 'monthly') {
                    var dayOfMonth = parseInt(document.getElementById('dayOfMonth').value) || 5;
                    execution_schedule.day_of_month = Math.max(1, Math.min(31, dayOfMonth));
                }
                
                callApi('update_execution_schedule', execution_schedule).then(function(scheduleResult) {
                    if (scheduleResult.success) {
                        alert('é…ç½®å·²ä¿å­˜');
                        closeModal('configModal');
                        // æ›´æ–°ç­–ç•¥æ˜¾ç¤º
                        loadCurrentStrategy();
                    } else {
                        alert('ä¿å­˜è°ƒåº¦é…ç½®å¤±è´¥: ' + scheduleResult.error);
                    }
                }).catch(function(error) {
                    alert('ä¿å­˜è°ƒåº¦é…ç½®å¤±è´¥: ' + error.toString());
                });
            }).catch(function(error) {
                alert('ä¿å­˜é…ç½®å¤±è´¥: ' + error.toString());
            });
        });

        function loadConfig() {
            callApi('get_config').then(function(result) {
                if (result.success && result.data) {
                    document.getElementById('qmtPath').value = result.data.qmt_path || '';
                    document.getElementById('accountId').value = result.data.account_id || '';
                    document.getElementById('fixedAmount').value = result.data.fixed_amount || 10000;
                    document.getElementById('notificationEmail').value = result.data.notification_email || '';
                    
                    var buyAmountType = result.data.buy_amount_type || 'average';
                    document.querySelector('input[name="buyAmountType"][value="' + buyAmountType + '"]').checked = true;
                    var orderType = result.data.order_type || 'limit';
                    document.querySelector('input[name="orderType"][value="' + orderType + '"]').checked = true;
                    
                    document.getElementById('fixedAmountGroup').style.display = 
                        result.data.buy_amount_type === 'fixed' ? 'block' : 'none';
                    
                    // åŠ è½½è°ƒåº¦é…ç½®
                    loadScheduleConfig();
                }
            });
        }

        function loadScheduleConfig() {
            callApi('get_current_strategy').then(function(strategyResult) {
                if (strategyResult.success && strategyResult.data && strategyResult.data.execution_schedule) {
                    var schedule = strategyResult.data.execution_schedule;
                    
                    // è®¾ç½®è°ƒåº¦ç±»å‹
                    var scheduleType = schedule.type || 'daily';
                    document.querySelector('input[name="scheduleType"][value="' + scheduleType + '"]').checked = true;
                    
                    // è®¾ç½®æ‰§è¡Œæ—¶é—´
                    document.getElementById('scheduleTime').value = schedule.time || '14:50';
                    
                    // è®¾ç½®æ¯å‘¨æ—¥æœŸ
                    if (scheduleType === 'weekly') {
                        var dayOfWeek = schedule.day_of_week || 0;
                        document.getElementById('dayOfWeek').value = dayOfWeek;
                        document.getElementById('weeklyDayGroup').style.display = 'block';
                    } else {
                        document.getElementById('weeklyDayGroup').style.display = 'none';
                    }
                    
                    // è®¾ç½®æ¯æœˆæ—¥æœŸ
                    if (scheduleType === 'monthly') {
                        document.getElementById('dayOfMonth').value = schedule.day_of_month || 5;
                        document.getElementById('monthlyDateGroup').style.display = 'block';
                    } else {
                        document.getElementById('monthlyDateGroup').style.display = 'none';
                    }
                } else {
                    // é»˜è®¤å€¼
                    document.querySelector('input[name="scheduleType"][value="daily"]').checked = true;
                    document.getElementById('scheduleTime').value = '14:50';
                    document.getElementById('weeklyDayGroup').style.display = 'none';
                    document.getElementById('monthlyDateGroup').style.display = 'none';
                }
            });
        }

        // ==================== å¸®åŠ© ====================
        document.getElementById('helpBtn').addEventListener('click', function() {
            document.getElementById('helpModal').style.display = 'flex';
        });

        async function openHelpUrl() {
            await callApi('open_help_url');
        }

        // ==================== æ¨¡æ€æ¡† ====================
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    // é…ç½®ä¿¡æ¯å¼¹çª—ç‚¹å‡»å¤–éƒ¨æ—¶ä¸å…³é—­
                    if (modal.id !== 'configModal') {
                        modal.style.display = 'none';
                    }
                }
            });
        });
    </script>
</body>
</html>

