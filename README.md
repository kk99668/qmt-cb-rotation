# QMT自动调仓 - 可转债轮动工具
基于 QMT 实现的可转债轮动自动调仓工具，开源仅供学习研究使用。

## 目录
- [功能特性](#功能特性)
- [项目说明](#项目说明)
- [适配环境](#适配环境)
- [使用建议](#使用建议)
- [安装与启动](#安装与启动)
- [配置说明](#配置说明)
- [使用指南](#使用指南)
- [常见问题](#常见问题)
- [开发指南](#开发指南)
- [更新日志](#更新日志)
- [风险提示 & 免责声明](#风险提示--免责声明)
- [许可证](#许可证)

## 功能特性
- 因子猫账号自动登录（支持记住密码）：[因子猫量化平台](https://yinzimao.com)
- 加载可转债策略及回测记录（分页浏览）
- 灵活配置：固定金额/余额均分买入、限价/市价单
- 自动调仓：按策略执行买卖操作
- 止盈止损：每分钟监控持仓，触发阈值自动操作
- 异常通知：交易异常邮件提醒（需配置邮箱）
- 定时任务：支持每日/每周/每月调仓
- 版本更新：自动检查新版本并提示

## 项目说明
本项目为个人开源的可转债轮动策略自动调仓辅助工具，仅作技术参考，不构成任何投资建议。

## 适配环境
- 仅在国金证券 mini QMT 环境测试通过，不保证其他券商/版本兼容
- 不同券商接口差异，可能导致一些未知问题
- 实盘前需在自身环境充分测试

## 使用建议
1. 人工监控：程序运行需定时检查，禁止完全无人值守
2. 模拟盘测试：新手先在模拟盘验证调仓逻辑、成交及稳定性
3. 小资金实盘：初期以小资金运行，逐步验证策略有效性

## 安装与启动
### 前置条件
- 操作系统：Windows 10/11
- Python 3.9+（需加入PATH）
- MiniQMT 客户端 (联系券商客户经理)
- （可选）Edge WebView2 Runtime（[下载地址](https://developer.microsoft.com/microsoft-edge/webview2/)）

### 安装步骤
```bash
# 1. 克隆项目
git clone <repository-url>
cd factor_qmt

# 2. （推荐）创建并激活虚拟环境
python -m venv venv
venv\Scripts\activate

# 3. 安装依赖
pip install -r requirements.txt

# 4. 配置 QMT SDK
将 MiniQMT 安装目录下的 `xtquant` 文件夹复制到项目根目录

# 5. 启动程序
python main.py
```

## 配置说明
### 基础配置（首次启动必填）
| 配置项 | 说明 | 必填 |
|--------|------|------|
| 因子猫账号/密码 | 登录因子猫平台 | 是 |
| MiniQMT 路径 | userdata_mini 文件夹路径 | 是 |
| 证券账号 | 券商交易账号 | 是 |
| 买入金额方式 | 固定金额/按余额平均分配 | 是 |
| 单只买入金额 | 每只可转债买入金额（元） | 是 |
| 交易单类型 | 限价单/市价单 | 是 |

### 高级配置
- 邮件通知：配置 SMTP 服务器、收发件邮箱等，用于交易异常提醒
- 止盈止损：自动获取因子猫策略参数，触发阈值时自动卖出
- 定时任务：支持每日/每周一/每月5号执行自动调仓
- 配置存储：所有配置加密保存在 `data/app.db` SQLite 数据库中

## 使用指南
### 核心操作流程
1. 登录：启动程序后输入因子猫账号密码（可选记住密码）
2. 选策略：加载策略列表，选择目标策略并查看回测记录
3. 配参数：在「设置」页面填写 MiniQMT 路径、交易账号、买入规则等
4. 启动交易：点击「开始交易」，程序自动执行选债、平仓非目标转债、买入新转债
5. 监控：主界面查看策略运行状态、持仓、交易日志，系统每分钟检查止盈止损

### 注意事项
- 仅在交易时间执行自动操作
- 确保网络稳定、账户资金充足
- 停牌可转债会被跳过并触发邮件通知（需配置邮箱）

## 常见问题
| 问题 | 解决方案 |
|------|----------|
| 提示找不到模块 | 执行 `pip install -r requirements.txt` 安装依赖 |
| 提示缺少 WebView2 | 下载并安装 Edge WebView2 Runtime |
| 程序无法启动 | 检查 Python 版本≥3.9，查看 `logs` 目录日志 |
| 找不到 MiniQMT 路径 | 定位安装目录下的 `userdata_mini` 文件夹 |
| 交易失败 | 检查 MiniQMT 已登录、账户资金充足、转债可交易，查看交易日志 |

## 开发指南
### 核心项目结构
```
qmt-cb-rotation/
├── main.py                # 程序入口
├── requirements.txt       # 依赖清单
├── assets/                # 前端静态资源
├── src/                   # 源代码
│   ├── api/               # PyWebView API 接口
│   ├── services/          # 核心业务（交易/调度/通知等）
│   ├── models/            # 数据模型与数据库操作
│   └── utils/             # 工具类（加密/日志等）
├── data/                  # SQLite 数据库
└── logs/                  # 日志文件
```

### 核心技术栈
- 桌面框架：PyWebView
- 开发语言：Python 3.9+
- 数据库：SQLite（SQLAlchemy 操作）
- 定时任务：APScheduler
- 打包工具：PyInstaller（配置文件 `build.spec`）

### 开发与打包
```bash
# 代码格式化/检查
pip install black flake8
black . && flake8 .

# 打包发布
pyinstaller build.spec  # 输出至 dist 目录
```

## 更新日志
### v1.0.0 (2025-02-11)
- 初始版本发布，支持因子猫登录、自动调仓、止盈止损、邮件通知等核心功能

## 风险提示 & 免责声明
1. 本工具为开源学习项目，非官方、非商用
2. 作者不对使用工具产生的盈利/亏损/资金损失承担责任
3. 使用工具即视为知悉风险，所有操作与风险自行承担
4. 投资有风险，入市需谨慎

## 许可证
Private - All Rights Reserved

## 联系方式
- 问题反馈：提交 Issue

## 致谢
- [PyWebView](https://pywebview.flowrl.com/)
- [MiniQMT](https://dict.thinktrader.net/)
- [因子猫](https://yinzimao.com)
